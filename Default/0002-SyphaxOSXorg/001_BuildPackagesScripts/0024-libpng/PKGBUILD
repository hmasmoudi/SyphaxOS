# Maintainer: Hatem Masmoudi <hatem.masmoudi@gmail.com>

pkgname=libpng
pkgver=1.6.31
pkgrel=1
pkgdesc="The libpng package contains libraries used by other programs for reading and writing PNG files."
arch=('x86_64')
url="http://downloads.sourceforge.net/libpng"
license=('GPL')
groups=('graphicslayer')
source=("$url/${pkgname}-${pkgver}.tar.xz")
sha256sums=('232a602de04916b2b5ce6f901829caf419519e6a16cc9cd7c1c91187d3ee8b41')
depends=('rootfs>=2.0.0')

prepare() {
   cd "$srcdir/$pkgname-$pkgver"
   
   curl -L http://downloads.sourceforge.net/project/apng/libpng/libpng16/$pkgname-$pkgver-apng.patch.gz | gzip -cd | patch -p0
}

build() {
   cd "$srcdir/$pkgname-$pkgver"
   
   ./configure LIBS="-lpthread" \
      --prefix=/usr \
      --disable-static \
      --enable-intel-sse \

   make
}

package() {
   cd "$srcdir/$pkgname-$pkgver"
   
   #Make the package
   make -j1 DESTDIR="$pkgdir" install
   
   cd contrib/pngminus
   make PNGLIB="-L$pkgdir/usr/lib -lpng" -f makefile.std png2pnm pnm2png
   install -m755 png2pnm pnm2png "$pkgdir/usr/bin/"
   install -D -m644 ../../LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

