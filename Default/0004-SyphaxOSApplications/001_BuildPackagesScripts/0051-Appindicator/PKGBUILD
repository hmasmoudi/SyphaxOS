# Maintainer: Hatem Masmoudi <hatem.masmoudi@gmail.com>

pkgname=appindicator
pkgver=17.10.2
pkgrel=4
pkgdesc="Integrates AppIndicators into GNOME Shell."
arch=('x86_64')
url="https://github.com/ubuntu/gnome-shell-extension-appindicator"
conflicts=('gnome-shell-extension-appindicator')
provides=('gnome-shell-extension-appindicator')
license=('GPL')
depends=('rootfs')

source=("${pkgname}-${pkgver}.tar.gz::https://github.com/Ubuntu/gnome-shell-extension-appindicator/archive/${pkgver}.tar.gz"
        "appIndicator.patch")
sha512sums=('SKIP' 'SKIP')

prepare() {
  cd "gnome-shell-extension-appindicator-${pkgver}"
  
  #fix icon size for SyphaxOS
  patch -Np0 -i ../appIndicator.patch
}

package() {
  cd "gnome-shell-extension-appindicator-${pkgver}"
  # Locate the extension.
  local _extname="$(grep -Po '(?<="uuid": ")[^"]*' metadata.json)"
  local _destdir="${pkgdir}/usr/share/gnome-shell/extensions/${_extname}"

  # Copy extension files into place.
  install -Dm644 -t "${_destdir}"                          ./*.js metadata.json
  install -Dm644 -t "${_destdir}/interfaces-xml"           ./interfaces-xml/*.xml
  
}
