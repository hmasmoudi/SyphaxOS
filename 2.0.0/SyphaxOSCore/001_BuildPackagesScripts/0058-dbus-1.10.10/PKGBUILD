# Maintainer: Hatem Masmoudi <hatem.masmoudi@gmail.com>

pkgname=dbus
pkgver=1.10.10
pkgrel=1
pkgdesc="D-Bus is a message bus system, a simple way for applications to talk to one another."
arch=('x86_64')
url="http://dbus.freedesktop.org/releases/dbus"
license=('GPL')
groups=('core')
source=("$url/$pkgname-$pkgver.tar.gz")
md5sums=('495676d240eb982921b3ad1343526849')
depends=('rootfs>=2.0.0')

prepare() {
   cd "$srcdir/$pkgname-$pkgver"
}

build() {
   cd "$srcdir/$pkgname-$pkgver"

   ./configure --prefix=/usr                        \
               --sysconfdir=/etc                    \
               --localstatedir=/var                 \
               --disable-static                     \
               --disable-doxygen-docs               \
               --disable-xml-docs                   \
               --docdir=/usr/share/doc/dbus-$pkgver \
               --with-console-auth-dir=/run/console

   make
}

package() {
   cd "$srcdir/$pkgname-$pkgver"

   make DESTDIR="$pkgdir" install

   mkdir -pv $pkgdir/{lib,run,var}
   ln -snfv ../run $pkgdir/var/run

   mv -v $pkgdir/usr/lib/libdbus-1.so.* $pkgdir/lib
   ln -sfv ../../lib/$(readlink /usr/lib/libdbus-1.so) $pkgdir/usr/lib/libdbus-1.so
   ln -sfv /etc/machine-id $pkgdir/var/lib/dbus

   rm -rf $pkgdir/var/run
}

