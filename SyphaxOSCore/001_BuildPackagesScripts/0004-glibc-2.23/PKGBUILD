# Maintainer: Hatem Masmoudi <hatem.masmoudi@gmail.com>

pkgname=glibc
pkgver=2.23
pkgrel=1
pkgdesc="The Glibc package contains the main C library."
arch=('x86_64')
url="http://ftp.gnu.org/gnu/glibc"
license=('GPL')
groups=('core')
source=("$url/$pkgname-$pkgver.tar.xz")
md5sums=('456995968f3acadbed39f5eba31678df')
depends=('rootfs>=1.0.0')

build() {
        cd "$srcdir/$pkgname-$pkgver"
        patch -Np1 -i ../../glibc-2.23-fhs-1.patch
        mkdir -v build
        cd build
        ../configure --prefix=/usr          \
                     --disable-profile      \
                     --enable-kernel=2.6.32 \
                     --enable-obsolete-rpc
        make
}

package() {
        cd "$srcdir/$pkgname-$pkgver"/build

        mkdir -p $pkgdir/etc/
        mkdir -p $pkgdir/lib
        mkdir -p $pkgdir/usr/lib
        ln -snfv lib $pkgdir/lib64
        ln -snfv lib $pkgdir/usr/lib64        
        
        touch $pkgdir/etc/ld.so.conf

        make DESTDIR="$pkgdir/" install
        
        cp -v ../nscd/nscd.conf $pkgdir/etc/nscd.conf       
        mkdir -pv $pkgdir/var/cache/nscd
        
        install -v -Dm644 ../nscd/nscd.tmpfiles $pkgdir/usr/lib/tmpfiles.d/nscd.conf
        install -v -Dm644 ../nscd/nscd.service $pkgdir/lib/systemd/system/nscd.service
        
        mkdir -pv $pkgdir/usr/lib/locale
       
        rm -rf $pkgdir/lib64
        rm -rf $pkgdir/usr/lib64
}
