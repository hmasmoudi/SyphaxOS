# Maintainer: Hatem Masmoudi <hatem.masmoudi@gmail.com>

pkgname=dbus
pkgver=1.10.6
pkgrel=1
pkgdesc="dbus"
arch=('x86_64')
url="http://dbus.freedesktop.org/releases/dbus"
license=('GPL')
groups=('core')
source=("$url/$pkgname-$pkgver.tar.gz")
md5sums=('26d0cf3a1c9782cb0e342101f0450440')
depends=('rootfs>=1.0.0')

prepare() {
        cd "$srcdir/$pkgname-$pkgver"
}

build() {
        cd "$srcdir/$pkgname-$pkgver"

        ./configure --prefix=/usr                       \
                    --sysconfdir=/etc                   \
                    --localstatedir=/var                \
                    --disable-static                    \
                    --disable-doxygen-docs              \
                    --disable-xml-docs                  \
                    --docdir=/usr/share/doc/dbus-1.10.6 \
                    --with-console-auth-dir=/run/console

        make
}

package() {
        cd "$srcdir/$pkgname-$pkgver"
        
        make DESTDIR="$pkgdir" install

        mkdir -pv $pkgdir/{lib,run,var}
        ln -snfv ../run $pkgdir/var/run

        mv -v $pkgdir/usr/lib/libdbus-1.so.* $pkgdir/lib
        ln -sfv ../../lib/$(readlink /usr/lib/libdbus-1.so) $pkgdir/usr/lib/libdbus-1.so
        ln -sfv /etc/machine-id $pkgdir/var/lib/dbus

        rm -rf $pkgdir/var/run
}
